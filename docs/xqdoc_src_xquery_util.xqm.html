<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="Generator" content="xquerydoc - https://github.com/xquery/xquerydoc"/><title>xqDoc - </title><style type="text/css">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #000;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 90%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="lib/prettify.js" type="text/javascript"> </script><script src="lib/lang-xq.js" type="text/javascript"> </script><link rel="stylesheet" type="text/css" href="lib/prettify.css"/></head><body class="home"><div id="main"><h1><span class="namespace">http://xproc.net/xproc/util</span>  library module </h1><div id="variables"><h3>Variables</h3><div id="var_NDEBUG"><h4><pre class="prettyprint lang-xq"><u>Variable</u>: $NDEBUG as </pre></h4><p> set to 1 to enable debugging </p></div></div><div id="functions"><h3>Functions</h3><div id="func_strip-whitespace_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: strip-whitespace($xml)</pre></h4><p> Processor Specific                                                         </p><h5>Params</h5><ul><li>xml as </li></ul></div><div id="func_string-to-base64_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: string-to-base64($string as xs:string)</pre></h4><h5>Params</h5><ul><li>string as  xs:string</li></ul></div><div id="func_store_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: store($href as xs:string,$data as item())</pre></h4><h5>Params</h5><ul><li>href as  xs:string</li><li>data as  item()</li></ul></div><div id="func_parse_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: parse($data as xs:string) as  item()</pre></h4><h5>Params</h5><ul><li>data as  xs:string</li></ul><h5>Returns</h5><ul><li> item()</li></ul></div><div id="func_serialize_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: serialize($xml) as  xs:string</pre></h4><h5>Params</h5><ul><li>xml as </li></ul><h5>Returns</h5><ul><li> xs:string</li></ul></div><div id="func_dirlist_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: dirlist($path)</pre></h4><h5>Params</h5><ul><li>path as </li></ul></div><div id="func_result-document_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: result-document($href as xs:string, $doc as item())</pre></h4><h5>Params</h5><ul><li>href as  xs:string</li><li>doc as  item()</li></ul></div><div id="func_binary-doc_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: binary-doc($uri)</pre></h4><h5>Params</h5><ul><li>uri as </li></ul></div><div id="func_binary-to-string_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: binary-to-string($data)</pre></h4><h5>Params</h5><ul><li>data as </li></ul></div><div id="func_serialize_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: serialize($xml,$options)</pre></h4><h5>Params</h5><ul><li>xml as </li><li>options as </li></ul></div><div id="func_evalXPATH_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: evalXPATH($xpath, $xml)</pre></h4><h5>Params</h5><ul><li>xpath as </li><li>xml as </li></ul></div><div id="func_evalXPATH_3"><h4><pre class="prettyprint lang-xq"><u>Function</u>: evalXPATH($xpath, $xml, $options)</pre></h4><h5>Params</h5><ul><li>xpath as </li><li>xml as </li><li>options as </li></ul></div><div id="func_xquery_3"><h4><pre class="prettyprint lang-xq"><u>Function</u>: xquery($query, $xml, $options)</pre></h4><h5>Params</h5><ul><li>query as </li><li>xml as </li><li>options as </li></ul></div><div id="func_xquery_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: xquery($query, $xml)</pre></h4><h5>Params</h5><ul><li>query as </li><li>xml as </li></ul></div><div id="func_transform_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: transform($stylesheet,$xml)</pre></h4><h5>Params</h5><ul><li>stylesheet as </li><li>xml as </li></ul></div><div id="func_transform_3"><h4><pre class="prettyprint lang-xq"><u>Function</u>: transform($stylesheet,$xml,$data)</pre></h4><h5>Params</h5><ul><li>stylesheet as </li><li>xml as </li><li>data as </li></ul></div><div id="func_outputResultElement_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: outputResultElement($exp)</pre></h4><h5>Params</h5><ul><li>exp as </li></ul></div><div id="func_get-secondary_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: get-secondary($name as xs:string,$secondary as element(xproc:input)*) as  item()*</pre></h4><h5>Params</h5><ul><li>name as  xs:string</li><li>secondary as  element(xproc:input)*</li></ul><h5>Returns</h5><ul><li> item()*</li></ul></div><div id="func_get-eval-option_3"><h4><pre class="prettyprint lang-xq"><u>Function</u>: get-eval-option($option-name as xs:string,$options as element(xproc:options),$primary) as  xs:string</pre></h4><h5>Params</h5><ul><li>option-name as  xs:string</li><li>options as  element(xproc:options)</li><li>primary as </li></ul><h5>Returns</h5><ul><li> xs:string</li></ul></div><div id="func_get-string-option_3"><h4><pre class="prettyprint lang-xq"><u>Function</u>: get-string-option($option-name as xs:string,$options as element(xproc:options),$primary) as  xs:string</pre></h4><h5>Params</h5><ul><li>option-name as  xs:string</li><li>options as  element(xproc:options)</li><li>primary as </li></ul><h5>Returns</h5><ul><li> xs:string</li></ul></div><div id="func_get-option_3"><h4><pre class="prettyprint lang-xq"><u>Function</u>: get-option($option-name as xs:string,$options as element(xproc:options),$primary) as  xs:string</pre></h4><h5>Params</h5><ul><li>option-name as  xs:string</li><li>options as  element(xproc:options)</li><li>primary as </li></ul><h5>Returns</h5><ul><li> xs:string</li></ul></div><div id="func_xprocxqError_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: xprocxqError($error,$string)</pre></h4><h5>Params</h5><ul><li>error as </li><li>string as </li></ul></div><div id="func_dynamicError_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: dynamicError($error,$string)</pre></h4><h5>Params</h5><ul><li>error as </li><li>string as </li></ul></div><div id="func_stepError_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: stepError($error,$string)</pre></h4><h5>Params</h5><ul><li>error as </li><li>string as </li></ul></div><div id="func_trace_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: trace($value as item()*, $what as xs:string)</pre></h4><h5>Params</h5><ul><li>value as  item()*</li><li>what as  xs:string</li></ul></div><div id="func_asserterror_3"><h4><pre class="prettyprint lang-xq"><u>Function</u>: asserterror($errortype as xs:string, $booleanexp as item(), $why as xs:string)</pre></h4><h5>Params</h5><ul><li>errortype as  xs:string</li><li>booleanexp as  item()</li><li>why as  xs:string</li></ul></div><div id="func_assert_2"><h4><pre class="prettyprint lang-xq"><u>Function</u>: assert($booleanexp as item(), $why as xs:string)</pre></h4><h5>Params</h5><ul><li>booleanexp as  item()</li><li>why as  xs:string</li></ul></div><div id="func_assert_3"><h4><pre class="prettyprint lang-xq"><u>Function</u>: assert($booleanexp as item(), $why as xs:string,$error)</pre></h4><h5>Params</h5><ul><li>booleanexp as  item()</li><li>why as  xs:string</li><li>error as </li></ul></div><div id="func_declarens_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: declarens($element)</pre></h4><h5>Params</h5><ul><li>element as </li></ul></div><div id="func_declare-ns_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: declare-ns($namespaces)</pre></h4><h5>Params</h5><ul><li>namespaces as </li></ul></div><div id="func_namespaces-in-use_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: namespaces-in-use( $root as node()?)</pre></h4><h5>Params</h5><ul><li>root as  node()?</li></ul></div><div id="func_enum-ns_1"><h4><pre class="prettyprint lang-xq"><u>Function</u>: enum-ns($element)</pre></h4><h5>Params</h5><ul><li>element as </li></ul></div></div><div><h3>Original Source Code</h3><pre class="prettyprint lang-xq">(: ------------------------------------------------------------------------------------- &#xD;
 &#xD;
	util.xqm - contains most of the XQuery processor specific functions, including all&#xD;
	helper functions.&#xD;
	&#xD;
---------------------------------------------------------------------------------------- :)&#xD;
xquery version "3.0" encoding "UTF-8";&#xD;
&#xD;
module namespace u = "http://xproc.net/xproc/util";&#xD;
&#xD;
(:&#xD;
 declare boundary-space strip;&#xD;
 declare copy-namespaces no-preserve,no-inherit;&#xD;
:)&#xD;
&#xD;
(:~ declare namespaces :)&#xD;
declare namespace p="http://www.w3.org/ns/xproc";&#xD;
declare namespace c="http://www.w3.org/ns/xproc-step";&#xD;
declare namespace err="http://www.w3.org/ns/xproc-error";&#xD;
declare namespace xsl="http://www.w3.org/1999/XSL/Transform";&#xD;
declare namespace xproc = "http://xproc.net/xproc";&#xD;
declare namespace std = "http://xproc.net/xproc/std";&#xD;
declare namespace opt = "http://xproc.net/xproc/opt";&#xD;
declare namespace ext = "http://xproc.net/xproc/ext";&#xD;
declare namespace xxq-error = "http://xproc.net/xproc/error";&#xD;
&#xD;
&#xD;
(:~ Module Imports :)&#xD;
import module namespace const = "http://xproc.net/xproc/const" at "const.xqm";&#xD;
&#xD;
declare default function namespace "http://www.w3.org/2005/xpath-functions";&#xD;
&#xD;
&#xD;
(:~ set to 1 to enable debugging :)&#xD;
declare variable $u:NDEBUG := $const:NDEBUG;&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
(:~ Processor Specific                                                         :)&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
&#xD;
declare function u:strip-whitespace($xml){&#xD;
let $template := &lt;xsl:stylesheet version="2.0"&gt;&#xD;
&lt;xsl:strip-space elements="*"/&gt; &#xD;
&lt;xsl:template match="."&gt;&#xD;
    &lt;xsl:apply-templates/&gt;&#xD;
&lt;/xsl:template&gt;&#xD;
&#xD;
&lt;xsl:template match="@*|*"&gt;&#xD;
    &lt;xsl:copy&gt;&#xD;
        &lt;xsl:apply-templates select="@*|node()"/&gt;&#xD;
    &lt;/xsl:copy&gt;&#xD;
&lt;/xsl:template&gt;&#xD;
&#xD;
&lt;xsl:template match="text()"&gt;&#xD;
&lt;xsl:value-of select="replace(.,'&amp;#xa;','')"/&gt;&#xD;
&lt;/xsl:template&gt;&#xD;
&#xD;
&lt;/xsl:stylesheet&gt;&#xD;
return&#xD;
  u:transform($template,$xml)&#xD;
};&#xD;
&#xD;
declare function u:string-to-base64($string as xs:string){&#xD;
  saxon:string-to-base64Binary($string, "UTF8")&#xD;
};&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:store($href as xs:string,$data as item()){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
let $result := saxon:result-document($href, $data, &lt;xsl:output method="xml"/&gt;)&#xD;
return&#xD;
  $href&#xD;
};&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:parse($data as xs:string) as item(){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
saxon:parse($data) &#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:serialize($xml) as xs:string{&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
saxon:serialize($xml, &lt;xsl:output method="xml" &#xD;
                             omit-xml-declaration="yes" &#xD;
                             indent="no"/&gt;) &#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:dirlist($path){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
collection(concat($path,"?select=*.*;recurse=yes;on-error=ignore"))&#xD;
};&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:result-document($href as xs:string, $doc as item()){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
let $writelog :=  saxon:result-document($href, $doc, &lt;xsl:output method="xml" indent="yes"/&gt;)&#xD;
return&#xD;
  $href&#xD;
};&#xD;
&#xD;
declare function u:binary-doc($uri){&#xD;
()&#xD;
};&#xD;
&#xD;
declare function u:binary-to-string($data){&#xD;
()&#xD;
};&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:serialize($xml,$options){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
$xml&#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
(: EVAL UTILITIES                                                             :)&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:evalXPATH($xpath, $xml){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
 let $document := document{$xml}&#xD;
 return&#xD;
  if ($xpath eq '/' or $xpath eq '' or empty($xml)) then&#xD;
    $document&#xD;
  else&#xD;
    u:xquery($xpath,$xml)&#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:evalXPATH($xpath, $xml, $options){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
 let $document := document{$xml}&#xD;
 return&#xD;
  if ($xpath eq '/' or $xpath eq '' or empty($xml)) then&#xD;
    $document&#xD;
  else&#xD;
    u:xquery($xpath,$xml,$options)&#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:xquery($query, $xml, $options){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
 let $o := for $option in $options &#xD;
 let $value as xs:string := if($option/@select ne'') then string($option/@select) else concat('&amp;quot;',$option/@value,'&amp;quot;')&#xD;
 return&#xD;
   concat(' declare variable $',$option/@name,' := ',$value,';')&#xD;
 let $q :=  concat($o,' ',$query)&#xD;
 return&#xD;
   u:xquery($q,$xml)&#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:xquery($query, $xml){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
 let $context := document{$xml}       &#xD;
let $compile  :=  saxon:compile-query(concat($const:default-ns,string($query)))&#xD;
 return&#xD;
   saxon:query($compile, $context)&#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:transform($stylesheet,$xml){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
  let $rendition := saxon:compile-stylesheet(document{$stylesheet})&#xD;
  return&#xD;
    saxon:transform($rendition, $xml)&#xD;
};&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:transform($stylesheet,$xml,$data){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
  let $rendition := saxon:compile-stylesheet(document{$stylesheet})&#xD;
  return&#xD;
    saxon:transform($rendition, $xml,$data)&#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
(: STEP UTILITIES                                                             :)&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:outputResultElement($exp){&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
    &lt;c:result&gt;{$exp}&lt;/c:result&gt;&#xD;
};&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:get-secondary($name as xs:string,$secondary as element(xproc:input)*) as item()*{&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
 document{  $secondary[@port eq $name]/node() }&#xD;
};&#xD;
&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:get-eval-option($option-name as xs:string,$options as element(xproc:options),$primary) as xs:string{&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
let $xpath as xs:string := string($options//p:with-option[@name eq $option-name]/@select)&#xD;
return&#xD;
if(starts-with($xpath,'&amp;quot;') and ends-with($xpath,'&amp;quot;')) then &#xD;
  concat('&amp;quot;',$xpath,'&amp;quot;')&#xD;
else&#xD;
string(u:evalXPATH($xpath,$primary,$options[@name]))&#xD;
};&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:get-string-option($option-name as xs:string,$options as element(xproc:options),$primary) as xs:string{&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
let $xpath as xs:string := string($options//p:with-option[@name eq $option-name]/@select)&#xD;
return&#xD;
  $xpath&#xD;
};&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:get-option($option-name as xs:string,$options as element(xproc:options),$primary) as xs:string{&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
let $xpath as xs:string := string($options//p:with-option[@name eq $option-name]/@select)&#xD;
return&#xD;
if(starts-with($xpath,'&amp;quot;') and ends-with($xpath,'&amp;quot;')) then &#xD;
 substring($xpath, 2, string-length($xpath) - 1)&#xD;
else if ( starts-with($xpath,'http') or starts-with($xpath,'file')) then &#xD;
  replace($xpath,"'","")&#xD;
else &#xD;
  replace($xpath,"'","")&#xD;
&#xD;
(:string(&#xD;
  u:evalXPATH($xpath,$primary,$options[@name])&#xD;
):)&#xD;
&#xD;
};&#xD;
&#xD;
&#xD;
&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
(: ERROR HANDLING                                                             :)&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:xprocxqError($error,$string) {&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
let $info := $const:xprocxq-error//xxq-error:error[@code=substring-after($error,':')]&#xD;
    return&#xD;
        error(QName('http://xproc.net/xproc/error',$error),concat($error,": xprocxq error - ",$string," ",$info/text(),'&amp;#10;'))};&#xD;
&#xD;
&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:dynamicError($error,$string) {&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
    let $info := $const:error//err:error[@code=substring-after($error,':')]&#xD;
    return&#xD;
        error(QName('http://www.w3.org/ns/xproc-error',$error),concat($error,": XProc Dynamic Error - ",$string," ",$info/text(),'&amp;#10;'))&#xD;
};&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:stepError($error,$string) {&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
let $info := $const:error//err:error[@code=substring-after($error,':')]&#xD;
    return&#xD;
        error(QName('http://www.w3.org/ns/xproc-error',$error),concat($error,": XProc Step Error - ",$string," ",$info/text(),'&amp;#10;'))&#xD;
};&#xD;
&#xD;
&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
(: ASSERTIONS, DEBUG TOOLS                                                    :)&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:trace($value as item()*, $what as xs:string)  {&#xD;
if(boolean($const:NDEBUG)) then&#xD;
    trace($value,$what)&#xD;
else&#xD;
    ()&#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:asserterror($errortype as xs:string, $booleanexp as item(), $why as xs:string)  {&#xD;
if(not($booleanexp) and boolean($const:NDEBUG)) then&#xD;
    u:dynamicError(fn:QName('http://www.w3.org/ns/xproc-error',$errortype),$why)&#xD;
else&#xD;
    ()&#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:assert($booleanexp as item(), $why as xs:string)  {&#xD;
if(not($booleanexp) and boolean($const:NDEBUG)) then &#xD;
    u:dynamicError('err:XC0020',$why)&#xD;
else&#xD;
    ()&#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
declare function u:assert($booleanexp as item(), $why as xs:string,$error)  {&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
if(not($booleanexp) and boolean($u:NDEBUG)) then &#xD;
    error(QName('http://www.w3.org/ns/xproc-error',$error),concat("XProc Assert Error: ",$why))&#xD;
else&#xD;
    ()&#xD;
};&#xD;
&#xD;
&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
(: manage namespaces                                                          :)&#xD;
(: -------------------------------------------------------------------------- :)&#xD;
&#xD;
declare function u:declarens($element){&#xD;
    u:declare-ns(u:enum-ns($element))&#xD;
};&#xD;
&#xD;
&#xD;
declare function u:declare-ns($namespaces){&#xD;
    for $ns in $namespaces//ns&#xD;
    return&#xD;
        ()&#xD;
};&#xD;
&#xD;
&#xD;
declare function u:namespaces-in-use( $root as node()? )  {&#xD;
       &#xD;
for $ns in distinct-values(&#xD;
      $root/descendant-or-self::*/(.)/in-scope-prefixes(.))&#xD;
&#xD;
return&#xD;
  if($ns ne 'xml' or $ns ne '' or namespace-uri-for-prefix($ns,$root) ne '') then&#xD;
  &lt;ns prefix="{$ns}" URI="{namespace-uri-for-prefix($ns,$root)}"/&gt;&#xD;
  else&#xD;
    ()&#xD;
 } ;&#xD;
&#xD;
declare function u:enum-ns($element){&#xD;
       for $child in $element/node()&#xD;
            return&#xD;
              if ($child instance of element() or $child instance of document-node()) then&#xD;
               	 u:namespaces-in-use($child)&#xD;
                else&#xD;
                  ()&#xD;
&#xD;
};&#xD;
&#xD;
&#xD;
(:&#xD;
declare function u:xquery($query as xs:string){&#xD;
    let $qry := if (starts-with($query,'/') or starts-with($query,'//')) then&#xD;
                concat('.',$query)&#xD;
			  else if(contains($query,'(/')) then&#xD;
				replace($query,'\(/','(./')&#xD;
              else if($query eq '') then&#xD;
			    u:dynamicError('err:XD0001','query is empty and/or XProc step is not supported')&#xD;
              else&#xD;
                  $query&#xD;
    let $result := util:eval($qry)   &#xD;
    return&#xD;
        $result&#xD;
};&#xD;
&#xD;
&#xD;
:)&#xD;
</pre></div><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><script type="application/javascript">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html>