<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="Generator" content="xquerydoc - https://github.com/xquery/xquerydoc"/><meta http-equiv="Authors" content="Copyright 2011 - John Snelson, James Fuller"/><title>xqDoc - </title><style type="text/css">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #000;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 90%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="lib/prettify.js" type="text/javascript"> </script><script src="lib/lang-xq.js" type="text/javascript"> </script><link rel="stylesheet" type="text/css" href="lib/prettify.css"/></head><body class="home"><div style="text-align:right;"><a href="index.html">XQuery API index</a></div><div id="main"><h1><span class="namespace"/>  library module </h1><div><h3>Variables</h3><ul><li>eval-step</li><li>run-step</li><li>declare-step</li><li>choose</li><li>try</li><li>group</li><li>for-each</li><li>viewport</li><li>library</li><li>pipeline</li><li>variable</li></ul></div><div><h3>Functions</h3><h4><pre class="prettyprint lang-xq"><u>Function:</u> group($primary,$secondary,$options,$currentstep)</pre></h4><h5>Params</h5><ul><li>primary: </li><li>secondary: </li><li>options: </li><li>currentstep: </li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> try($primary,$secondary,$options,$currentstep)</pre></h4><h5>Params</h5><ul><li>primary: </li><li>secondary: </li><li>options: </li><li>currentstep: </li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> for-each($primary,$secondary,$options,$currentstep)</pre></h4><h5>Params</h5><ul><li>primary: </li><li>secondary: </li><li>options: </li><li>currentstep: </li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> viewport($primary,$secondary,$options,$currentstep)</pre></h4><h5>Params</h5><ul><li>primary: </li><li>secondary: </li><li>options: </li><li>currentstep: </li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> resolve-external-bindings($a,$b)</pre></h4><h5>Params</h5><ul><li>a: </li><li>b: </li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> genstepnames($step) as  xs:string*</pre></h4><h5>Params</h5><ul><li>step: </li></ul><h5>Returns</h5><ul><li>:  xs:string</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> generate_output($step,$port,$port-type,$primary,$content) as  element(xproc:output)</pre></h4><h5>Params</h5><ul><li>step: </li><li>port: </li><li>port-type: </li><li>primary: </li><li>content: </li></ul><h5>Returns</h5><ul><li>:  element(xproc:output)</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> resolve-document-binding($href as xs:string) as  item()</pre></h4><h5>Params</h5><ul><li>href:  xs:string</li></ul><h5>Returns</h5><ul><li>:  item()</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> resolve-data-binding($href as xs:string,$wrapper as xs:string) as  element(c:data)</pre></h4><h5>Params</h5><ul><li>href:  xs:string</li><li>wrapper:  xs:string</li></ul><h5>Returns</h5><ul><li>:  element(c:data)</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> resolve-port-binding($input,$outputs,$ast,$currentstep)</pre></h4><h5>Params</h5><ul><li>input: </li><li>outputs: </li><li>ast: </li><li>currentstep: </li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> eval-options($ast,$stepname as xs:string) as  element(xproc:options)</pre></h4><h5>Params</h5><ul><li>ast: </li><li>stepname:  xs:string</li></ul><h5>Returns</h5><ul><li>:  element(xproc:options)</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> eval-secondary($ast as element(p:declare-step),$currentstep,$primaryinput as item()*,$outputs as item()*)</pre></h4><h5>Params</h5><ul><li>ast:  element(p:declare-step)</li><li>currentstep: </li><li>primaryinput:  item()</li><li>outputs:  item()</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> eval-primary($ast as element(p:declare-step),$currentstep,$primaryinput as item()*,$outputs as item()*)</pre></h4><h5>Params</h5><ul><li>ast:  element(p:declare-step)</li><li>currentstep: </li><li>primaryinput:  item()</li><li>outputs:  item()</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> evalstep($step,$namespaces,$primaryinput as item()?,$ast as element(p:declare-step),$outputs)</pre></h4><h5>Params</h5><ul><li>step: </li><li>namespaces: </li><li>primaryinput:  item()</li><li>ast:  element(p:declare-step)</li><li>outputs: </li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> enum-namespaces($pipeline) as  element(namespace)</pre></h4><h5>Params</h5><ul><li>pipeline: </li></ul><h5>Returns</h5><ul><li>:  element(namespace)</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> output($result,$dflag as xs:integer) as  item()*</pre></h4><h5>Params</h5><ul><li>result: </li><li>dflag:  xs:integer</li></ul><h5>Returns</h5><ul><li>:  item()</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> evalAST($ast as element(p:declare-step),
   $evalstep,$namespaces as element(namespace),$stdin as item()* ,$bindings,$outputs as item()?) as  item()*</pre></h4><h5>Params</h5><ul><li>ast:  element(p:declare-step)</li><li>evalstep: </li><li>namespaces:  element(namespace)</li><li>stdin:  item()</li><li>bindings: </li><li>outputs:  item()</li></ul><h5>Returns</h5><ul><li>:  item()</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> stepFoldEngine( $ast as element(p:declare-step),
                              $namespaces as element(namespace),
                              $steps as xs:string*,
                              $evalstep-function,
                              $primary as item()?,
                              $outputs as item()*)</pre></h4><h5>Params</h5><ul><li>ast:  element(p:declare-step)</li><li>namespaces:  element(namespace)</li><li>steps:  xs:string</li><li>evalstep-function: </li><li>primary:  item()</li><li>outputs:  item()</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> run($pipeline,$stdin as item()?,$bindings,$options,$outputs,$dflag as xs:integer ,$tflag as xs:integer) as  item()*</pre></h4><h5>Params</h5><ul><li>pipeline: </li><li>stdin:  item()</li><li>bindings: </li><li>options: </li><li>outputs: </li><li>dflag:  xs:integer</li><li>tflag:  xs:integer</li></ul><h5>Returns</h5><ul><li>:  item()</li></ul><h4><pre class="prettyprint lang-xq"><u>Function:</u> getstep($stepname as xs:string)</pre></h4><h5>Params</h5><ul><li>stepname:  xs:string</li></ul></div><div><h3>Original Source Code</h3><pre class="prettyprint lang-xq">xquery version "3.0"  encoding "UTF-8";

module namespace xproc = "http://xproc.net/xproc";

 declare boundary-space preserve;
 declare copy-namespaces no-preserve,no-inherit;

 (: declare namespaces :)
 declare namespace p="http://www.w3.org/ns/xproc";
 declare namespace c="http://www.w3.org/ns/xproc-step";
 declare namespace err="http://www.w3.org/ns/xproc-error";

 (: module imports :)
 import module namespace const = "http://xproc.net/xproc/const" at "const.xqm";
 import module namespace parse = "http://xproc.net/xproc/parse" at "parse.xqm";
 import module namespace     u = "http://xproc.net/xproc/util"  at "util.xqm";
 import module namespace   std = "http://xproc.net/xproc/std"   at "std.xqm";
 import module namespace   opt = "http://xproc.net/xproc/opt"   at "opt.xqm";
 import module namespace   ext = "http://xproc.net/xproc/ext"   at "ext.xqm";

 (: declare variables :)
 declare variable $xproc:eval-step       := xproc:evalstep#5;

 (: declare steps :)
 declare variable $xproc:run-step       := xproc:run#7;
 declare variable $xproc:declare-step   := ();
 declare variable $xproc:choose         := ();
 declare variable $xproc:try            := xproc:try#4;
 declare variable $xproc:group          := xproc:group#4;
 declare variable $xproc:for-each       := xproc:for-each#4;
 declare variable $xproc:viewport       := xproc:viewport#4;
 declare variable $xproc:library        := ();
 declare variable $xproc:pipeline       := ();
 declare variable $xproc:variable       := ();

 (: declare options :)
 declare option saxon:output "indent=yes";


 (:~ p:group step implementation
 :
 : @param $primary -
 : @param $secondary -
 : @param $options -
 : @param $currentstep -
 :
 : @returns 
 :)
(: -------------------------------------------------------------------------- :)
declare function xproc:group($primary,$secondary,$options,$currentstep) {
(: -------------------------------------------------------------------------- :)
let $namespaces  := xproc:enum-namespaces($currentstep)
let $defaultname as xs:string := string($currentstep/@xproc:default-name)
let $ast := &lt;p:declare-step name="{$defaultname}" xproc:default-name="{$defaultname}" &gt;{$currentstep/node()}&lt;/p:declare-step&gt;
return
  xproc:output(xproc:evalAST($ast,$xproc:eval-step,$namespaces,$primary,(),()), 0)
};


 (:~ p:try step implementation
 :
 : @param $primary -
 : @param $secondary -
 : @param $options -
 : @param $currentstep -
 :
 : @returns 
 :)
(: -------------------------------------------------------------------------- :)
declare function xproc:try($primary,$secondary,$options,$currentstep) {
(: -------------------------------------------------------------------------- :)
let $namespaces  := xproc:enum-namespaces($currentstep)
let $defaultname as xs:string := string($currentstep/@xproc:default-name)
let $ast-try := &lt;p:declare-step name="{$defaultname}" xproc:default-name="{$defaultname}" &gt;{$currentstep/*[name(.) ne 'p:catch']}&lt;/p:declare-step&gt;
let $ast-catch := &lt;p:declare-step name="{$defaultname}" xproc:default-name="{$defaultname}" &gt;{$currentstep/p:catch/node()}&lt;/p:declare-step&gt;

return
  try{
    xproc:output(xproc:evalAST($ast-try,$xproc:eval-step,$namespaces,$primary,(),()), 0)
  }catch *{
    xproc:output(xproc:evalAST($ast-catch,$xproc:eval-step,$namespaces,$primary,(),()), 0)
  }
};


 (:~ p:for-each step implementation
 :
 : @param $primary -
 : @param $secondary -
 : @param $options -
 : @param $currentstep -
 :
 : @returns 
 :)
(: -------------------------------------------------------------------------- :)
declare function xproc:for-each($primary,$secondary,$options,$currentstep) {
(: -------------------------------------------------------------------------- :)
let $namespaces  := xproc:enum-namespaces($currentstep)
let $defaultname as xs:string := string($currentstep/@xproc:default-name)
let $iteration-select as xs:string   := string($currentstep/ext:pre/p:iteration-source/@select)
let $ast := &lt;p:declare-step name="{$defaultname}" xproc:default-name="{$defaultname}" &gt;{$currentstep/node()}&lt;/p:declare-step&gt;
return
for $item in u:evalXPATH($iteration-select,document{$primary})
return
  xproc:output(xproc:evalAST($ast,$xproc:eval-step,$namespaces,$item,(),()), 0)
};


 (:~ p:viewport step implementation
 :
 : @param $primary -
 : @param $secondary -
 : @param $options -
 : @param $currentstep -
 :
 : @returns 
 :)
(: -------------------------------------------------------------------------- :)
declare function xproc:viewport($primary,$secondary,$options,$currentstep) {
(: -------------------------------------------------------------------------- :)
let $namespaces  := xproc:enum-namespaces($currentstep)
let $defaultname as xs:string := string($currentstep/@xproc:default-name)
let $iteration-select as xs:string   := string($currentstep/ext:pre/p:viewport-source/@select)
let $ast := &lt;p:declare-step name="{$defaultname}" xproc:default-name="{$defaultname}" &gt;{$currentstep/node()}&lt;/p:declare-step&gt;
return
for $item at $count in u:evalXPATH($iteration-select,document{$primary})
return
  xproc:output(xproc:evalAST($ast,$xproc:eval-step,$namespaces,$item,(),()), 0)
};


 (:~ resolve external bindings
 :
 : @param $a -
 : @param $b -
 :
 : @returns 
 :)
 (: --------------------------------------------------------------------------- :)
 declare function xproc:resolve-external-bindings($a,$b) {
 (: -------------------------------------------------------------------------- :)
() 
 };

 (:~ generates a sequence of xs:string containing step names
 :
 : @param $step - 
 :
 : @returns xs:string of xproc:default-name
 :)
 (: --------------------------------------------------------------------------- :)
 declare function xproc:genstepnames($step) as xs:string* {
 (: -------------------------------------------------------------------------- :)
      for $name in  $step/*[@xproc:step eq "true"]
        return
          $name/@xproc:default-name
 };


 (:~ utility function for generating xproc:output
 :
 : @param $step - 
 : @param $port - 
 : @param $port-type - 
 : @param $primary - 
 : @param $content - 
 :
 : @returns xproc:output
 :)
 (: ------------------------------------------------------------------------------------------------------------- :)
 declare function xproc:generate_output($step,$port,$port-type,$primary,$content) as element(xproc:output){
 (: ------------------------------------------------------------------------------------------------------------- :)
 &lt;xproc:output
  step="{$step}"
  xproc:default-name="{$step}"
  port="{$port}"
  port-type="{$port-type}"
  primary="{$primary}"
  func=""&gt;{$content}&lt;/xproc:output&gt;
 };


 (:~ resolve p:document input port bindings
 :
 : @param $href - href of document you wish to access
 :
 : @returns 
 :)
 (: -------------------------------------------------------------------------- :)
 declare function xproc:resolve-document-binding($href as xs:string) as item(){
 (: -------------------------------------------------------------------------- :)
    if (doc-available($href)) then
        doc($href)
    else
        u:dynamicError('err:XD0002',concat(" cannot access document ",$href))
 };


(:~ resolve p:data input port bindings
 :
 :
 : @param $href - xs:string
 : @param $wrapper  - xs:string
 :
 : @returns c:data
 :)
 (: -------------------------------------------------------------------------- :)
 declare function xproc:resolve-data-binding($href as xs:string,$wrapper as xs:string) as element(c:data){
 (: -------------------------------------------------------------------------- :)
&lt;c:data
  content-type =""
  charset = ""
  encoding = ""&gt;
    string
&lt;/c:data&gt;
(:
    u:dynamicError('err:XD0002',concat("cannot access file:  ",$href))
:)
 };


(:~ resolve input port bindings
 :
 : Will process p:empty, p:inline, p:document, p:data, p:pipe
 : or throw err:XD0001 
 :
 :
 : @param $input - 
 : @param $result  - TODO rename to outputs
 : @param $ast -
 : @param $currentstep 
 : @returns 
 :)
 (: -------------------------------------------------------------------------- :)
 declare function xproc:resolve-port-binding($input,$outputs,$ast,$currentstep){
 (: -------------------------------------------------------------------------- :)
   typeswitch($input)
     case element(p:empty)
       return &lt;empty/&gt;
     case element(p:inline)
       return $input/*
     case element(p:document)
       return xproc:resolve-document-binding($input/@href)
     case element(p:data)
       return xproc:resolve-data-binding($input/@href,'')
     case element(p:pipe)
       return $outputs[@xproc:default-name eq $input/@xproc:step-name][@port eq $input/@port]/node()
     default 
       return
         u:dynamicError('err:XD0001',concat("cannot bind to port: ",$input/@port," step: ",$input/@step,' ',u:serialize($currentstep,$const:TRACE_SERIALIZE)))
};


(:~ evaluates step options
 :
 :
 : @param $ast - 
 : @param $stepname - 
 :
 : @returns xproc:options
 :)
 (: -------------------------------------------------------------------------- :)
 declare function xproc:eval-options($ast,$stepname as xs:string) as element(xproc:options){
 (: -------------------------------------------------------------------------- :)
     &lt;xproc:options&gt;
         {$ast/*[@xproc:default-name=$stepname]/p:with-option}
     &lt;/xproc:options&gt;
 };


(:~ evaluates secondary input bindings to a step
 :
 :
 : @param $ast - 
 : @param $currentstep
 : @param $primaryinput
 : @param $outputs
 :
 : @returns 
 :)
 (: -------------------------------------------------------------------------- :)
 declare function xproc:eval-secondary($ast as element(p:declare-step),$currentstep,$primaryinput as item()*,$outputs as item()*){
 (: -------------------------------------------------------------------------- :)
 let $step-name as xs:string := string($currentstep/@xproc:default-name)
 return
 for $input in $currentstep/p:input[@primary eq 'false']
 return
 &lt;xproc:input port="{$input/@port}" select="{$input/@select}"&gt;
   {
     let $primaryresult := document{
     for $child in $input/node()
     return
       xproc:resolve-port-binding($child,$outputs,$ast,$currentstep)
     }
     let $data :=  if($input/node()) then
       (: resolve each nested port binding :)
       for $input1 in $input/*
       return
         xproc:resolve-port-binding($input1,$outputs,$ast,$currentstep)
       else
         if(name($primaryinput) eq 'xproc:output') then $primaryinput/node() else $primaryinput
           let $result :=  u:evalXPATH(string($input/@select),$data)
           return
             if ($result) then
               $result
             else
               &lt;error type="eval-secondary"/&gt;
           (:    u:dynamicError('err:XD0016',concat("xproc step ",$step-name, "did not select anything from p:input")) :)
   }
 &lt;/xproc:input&gt;
 };


 (:~ evaluates primary input bindings to a step
  :
  : a) checks to see if there are multiple children to p:input and uses xproc:resolve-port-binding to resolve them
  : b) applies xpath select processesing (if did not select anything this is an error)
  : c) 
  :
  :
  :
  : @param $ast - we require ast to refer to stuff
  : @param $step - 
  : @param $currentstep - actual current step
  : @param $primaryinput - primary input
  : @param $outputs - all of the previously processed steps outputs, including in scope variables and options
  :
  : @returns item()*
 :)
 (:---------------------------------------------------------------------------:)
 declare function xproc:eval-primary($ast as element(p:declare-step),$currentstep,$primaryinput as item()*,$outputs as item()*){
 (: -------------------------------------------------------------------------- :)
 let $step-name as xs:string := string($currentstep/@xproc:default-name)
 let $pinput as element(p:input)? := $currentstep/p:input[@primary eq 'true']
 let $data :=  if($pinput/node() and empty($primaryinput)) then
   (: resolve each nested port binding :)
   for $input in $pinput/*
   return
     xproc:resolve-port-binding($input,$outputs,$ast,$currentstep)
   else
     if(name($primaryinput) eq 'xproc:output') then $primaryinput/node() else $primaryinput
 let $result :=  u:evalXPATH(string($pinput/@select),$data)
 return
   if ($result) then
     document{$result}
   else
     &lt;error1 type="eval-primary"/&gt;
   (:  u:dynamicError('err:XD0016',concat("xproc step ",$step-name, "did not select anything from p:input")) :)
};


 (:~ evaluates an xproc step
  :
  : @param $step - step's xproc:default-name
  : @param $namespaces - namespaces in use 
  : @param $primaryinput - standard input into the step
  : @param $ast - full abstract syntax tree of the pipeline being processed
  : @param $outputs - all of the previously processed steps outputs, including in scope variables and options
  :
  : @returns item()*
 :)
 (: -------------------------------------------------------------------------- :)
 declare function xproc:evalstep ($step,$namespaces,$primaryinput as item()?,$ast as element(p:declare-step),$outputs) {
 (: -------------------------------------------------------------------------- :)
     let $declarens    := u:declare-ns($namespaces)
     let $variables    := $outputs/xproc:variable
     let $options      := xproc:eval-options($ast,$step)
     let $currentstep  := $ast/*[@xproc:default-name eq $step][1]
     let $stepfunc     := name($currentstep)
     let $stepfunction := xproc:getstep($stepfunc)
     let $primary      := xproc:eval-primary($ast,$currentstep,$primaryinput,$outputs)
     let $secondary    := xproc:eval-secondary($ast,$currentstep,$primaryinput,$outputs)

     let $log-href := $currentstep/p:log/@href
     let $log-port := $currentstep/p:log/@port

     return

         if(name($currentstep) = "p:declare-step") then
            ()
         else
           (
             (: primary input port :)
             &lt;xproc:output step="{$step}"
             xproc:default-name="{$step}"
             port-type="input"
             href="{if ($log-port eq $currentstep/p:input[1][@primary eq 'true']/@port) then u:result-document($log-href,$primary) else ()}"
             primary="true"
             select="{$currentstep/p:input[1][@primary eq 'true']/@select}"
             port="{$currentstep/p:input[1][@primary eq 'true']/@port}"
             func="{$stepfunc}"&gt;{$primary}&lt;/xproc:output&gt;
             ,
             (: all other input ports :)
             (  for $child in $secondary/xproc:input
             return
             &lt;xproc:output step="{$step}"
             xproc:default-name="{$step}"
             port-type="input"
             href="{if ($log-port eq $child/@port) then u:result-document($log-href,$child/node()) else ()}"
             primary="false"
             select="{$child/@select}"
             port="{$currentstep/p:input[1][@primary eq 'false']/@port}"
             func="{$stepfunc}"&gt;{$child/node()}&lt;/xproc:output&gt;
             )
             ,
             (: primary output port :)
             if($currentstep/p:output[@primary='true']) then
             &lt;xproc:output step="{$step}"
             port-type="output"
             href="{if ($log-port eq $currentstep/p:output[1][@primary eq 'true']/@port) then $log-href else ()}"
             primary="true"
             xproc:default-name="{$step}"
             select="{$currentstep/p:output[@primary eq 'true']/@select}"
             port="{$currentstep/p:output[@primary eq 'true']/@port}"
             func="{$stepfunc}"&gt;{$stepfunction($primary,$secondary,$options,$variables)}&lt;/xproc:output&gt;
             else if($currentstep/ext:pre) then
             &lt;xproc:output step="{$step}"
             port-type="output"
             href="{if ($log-port eq $currentstep/p:output[1][@primary eq 'true']/@port) then $log-href else ()}"
             primary="true"
             xproc:default-name="{$step}"
             select="{$currentstep/p:output[@primary eq 'true']/@select}"
             port="result"
             func="{$stepfunc}"&gt;{$stepfunction($primary,$secondary,$options,$currentstep)}&lt;/xproc:output&gt;
             else
             (: all other primary output ports @TODO - needs to be handled :)
             &lt;xproc:output step="{$step}"
             port-type="output"
             href="{if ($log-port eq $currentstep/p:output[1][@primary eq 'false']/@port) then $log-href else ()}"
             primary="false"
             xproc:default-name="{$step}"
             select="{$currentstep/p:output[@primary eq 'false']/@select}"
             port="{$currentstep/p:output[@primary eq 'false']/@port}"
             func="{$stepfunc}"/&gt;
         )
 };


 (:~
  : lists all namespaces which are declared and in use within pipeline 
  : @TODO possibly move to util.xqm and delineate between declared and in use
  :
  : @param $pipeline - returns all in use namespaces

  : @returns &lt;namespace/&gt; element
  :)
 (: ------------------------------------------------------------------------------------------------------------- :)
 declare function xproc:enum-namespaces($pipeline) as element(namespace){
 (: ------------------------------------------------------------------------------------------------------------- :)
    &lt;namespace name="{$pipeline/@name}"&gt;{u:enum-ns(&lt;dummy&gt;{$pipeline}&lt;/dummy&gt;)}&lt;/namespace&gt;
 };


 (:~
  : prepares the output from for xproc:stepFoldEngine
  :
  : This is a preprocess before serialization and actual output to standard output
  : or wherever externally from xprocxq
  :
  : @param $result - all outputs from the result of processing pipeline
  : @param $dflag - if true will output full processing trace
  :
  : @returns item()* 
  :)
 (: -------------------------------------------------------------------------- :)
 declare function xproc:output($result,$dflag as xs:integer) as item()*{
 (: -------------------------------------------------------------------------- :)
 let $ast    :=subsequence($result,1,1)
 let $output := &lt;xproc:outputs&gt;{ subsequence($result,2) } &lt;/xproc:outputs&gt;
 return
   if($dflag eq 1) then
   &lt;xproc:debug
   xmlns:p="http://www.w3.org/ns/xproc"
   xmlns:ext="http://xproc.net/xproc/ext"
   xmlns:c="http://www.w3.org/ns/xproc-step"
   xmlns:err="http://www.w3.org/ns/xproc-error"
   xmlns:xxq-error="http://xproc.net/xproc/error"
   xmlns:opt="http://xproc.net/xproc/opt"
   &gt;
     &lt;xproc:pipeline&gt;{$ast}&lt;/xproc:pipeline&gt;
     {$output}
   &lt;/xproc:debug&gt;
 else
   $result[last()]/node()
 };


 (:~
  : runtime processing wrapper for xproc:stepFoldEngine 
  : @TODO - may push this down back to xproc:run
  :
  : This level of abstraction is probably temporary
  :
  : @param $ast - abstract syntax tree representing pipeline
  : @param $evalstep - function for evaluating each step (allows for flexible processing)
  : @param $namespaces - all namespaces that are used within pipeline
  : @param $stdin - standard input into the pipeline
  : @param $bindings - declared port bindings
  : @param $outputs - starting outputs, used for ext:xproc and branching pipelines
  :
  : @returns 
  :)
 (: ------------------------------------------------------------------------------------------------------------- :)
 declare function xproc:evalAST($ast as element(p:declare-step),
   $evalstep,$namespaces as element(namespace),$stdin as item()* ,$bindings,$outputs as item()?) as item()* {
 (: ------------------------------------------------------------------------------------------------------------- :)
     let $steps := xproc:genstepnames($ast)
     let $pipeline-name := $ast/@xproc:default-name
     return
         xproc:stepFoldEngine($ast,
         $namespaces,
         $steps,
         $evalstep,
         $stdin,
         ($outputs,
         &lt;xproc:variable/&gt;, 
         xproc:resolve-external-bindings($bindings,$pipeline-name),
         if ($stdin) then
           xproc:generate_output($pipeline-name,'result','external','true',$stdin)
         else
           ()
          )
         )
 };


 (:~
  : xproc pipeline is processed using a recursive step fold function
  : 
  :
  : This is the central mechanism by which xprocxq works. By using a step-fold
  : function we have a flexible method of working with xproc branches, ext:xproc
  : invokes, as well as opening up all sorts of possibilities to work Map/Reduce
  : style.
  :
  :
  : 
  :
  :
  :
  :
  :  
  : @param $ast - abstract syntax tree representing pipeline
  : @param $namespaces - all namespaces that are used within pipeline
  : @param $steps - 
  : @param $evalstep-function - 
  : @param $primary - starting input
  : @param $outputs - starting outputs, used for ext:xproc and branching pipelines
  :
  : @returns ($ast, $outputs)
  :)
 (: -------------------------------------------------------------------------- :)
 declare function xproc:stepFoldEngine( $ast as element(p:declare-step),
                              $namespaces as element(namespace),
                              $steps as xs:string*,
                              $evalstep-function,
                              $primary as item()?,
                              $outputs as item()*  ) {
 (: -------------------------------------------------------------------------- :)

    if (empty($steps)) then
      ($ast,$outputs)                       
    else
      let $result :=  $evalstep-function(   
        $steps[1],
        $namespaces,
        $primary,
        $ast,
        $outputs)
        return
          xproc:stepFoldEngine($ast,                 
          $namespaces,         
          remove($steps, 1),
          $evalstep-function,
          $result[last()],
          ($outputs,$result))
};


 (:~
  : entry point into xprocxq returning the final serialized output of pipeline processing
  :
  : @param $pipeline - xproc pipeline
  : @param $stdin - externally defined standard input
  : @param $bindings - externally declared port bindings
  : @param $options - externally declared options
  : @param $outputs - externally declared output
  : @param $dflag - debug flag
  : @param $tflag - timing flag
  :
  : @returns item()*
  :)
 (: ------------------------------------------------------------------------------------------------------------- :)
 declare function xproc:run($pipeline,$stdin as item()?,$bindings,$options,$outputs,$dflag as xs:integer ,$tflag as xs:integer) as item()*{
 (: ------------------------------------------------------------------------------------------------------------- :)
 let $validate   := () (: validation:jing($pipeline,fn:doc($const:xproc-rng-schema)) :)
 let $namespaces := xproc:enum-namespaces($pipeline)
 let $parse      := parse:explicit-bindings( parse:AST(parse:explicit-name(parse:explicit-type($pipeline))))
 let $b := $parse/*
 let $ast        := element p:declare-step {$parse/@*,
   namespace p {"http://www.w3.org/ns/xproc"},
   namespace xproc {"http://xproc.net/xproc"},
   namespace ext {"http://xproc.net/xproc/ext"},
   namespace opt {"http://xproc.net/xproc/opt"},
   namespace c {"http://www.w3.org/ns/xproc-step"},
   namespace err {"http://www.w3.org/ns/xproc-error"},
   namespace xxq-error {"http://xproc.net/xproc/error"},
   parse:pipeline-step-sort( $b,  &lt;p:declare-step xproc:default-name="{$const:init_unique_id}"/&gt; )
 }
 let $checkAST          := u:assert(not(empty($ast/*[@xproc:step])),"pipeline AST has no steps")
 let $eval_result       := xproc:evalAST($ast,$xproc:eval-step,$namespaces,$stdin,$bindings,$outputs)
 let $serialized_result := xproc:output($eval_result,$dflag)
 return

let $g := parse:AST(parse:explicit-name(parse:explicit-type($pipeline)))
return
   $serialized_result
 };



(:~ waiting for fn:function-lookup() to be supported by XQuery implementations
 :
 : This is a *temporary* function as a dynamic function constructor
 : it eventually will be replaced by the new fn:function-lookup() 
 : function which will make its way into the final xquery/xpath 3.0
 : specs
 :
 : @param $stepname - string containing name of element
 :
 : @returns function
 :
 :)
(: -------------------------------------------------------------------------- :)
declare function xproc:getstep($stepname as xs:string){
(: -------------------------------------------------------------------------- :)
if ($stepname eq 'p:identity') then
  $std:identity
else if($stepname eq 'p:count') then
  $std:count
else if($stepname eq 'p:pack') then
  $std:pack
else if($stepname eq 'p:delete') then
  $std:delete
else if($stepname eq 'p:add-attribute') then
  $std:add-attribute
else if($stepname eq 'p:add-xml-base') then
  $std:add-xml-base
else if($stepname eq 'p:error') then
  $std:error
else if($stepname eq 'p:escape-markup') then
  $std:escape-markup
else if($stepname eq 'p:unescape-markup') then
  $std:unescape-markup
else if($stepname eq 'p:directory-list') then
  $std:directory-list
else if($stepname eq 'p:load') then
  $std:load
else if($stepname eq 'p:store') then
  $std:store
else if($stepname eq 'p:make-absolute-uris') then
  $std:make-absolute-uris
else if($stepname eq 'p:compare') then
  $std:compare
else if($stepname eq 'p:label-elements') then
  $std:label-elements
else if($stepname eq 'ext:pre') then
  $ext:pre
else if($stepname eq 'p:rename') then
  $std:rename
else if($stepname eq 'p:filter') then
  $std:filter
else if($stepname eq 'p:string-replace') then
  $std:string-replace
else if($stepname eq 'p:split-sequence') then
  $std:split-sequence
else if($stepname eq 'p:sink') then
  $std:sink
else if($stepname eq 'p:set-attributes') then
  $std:set-attributes
else if($stepname eq 'p:rename') then
  $std:rename
else if($stepname eq 'p:wrap') then
  $std:wrap
else if($stepname eq 'p:wrap-sequence') then
  $std:wrap-sequence
else if($stepname eq 'p:unwrap') then
  $std:unwrap
else if($stepname eq 'p:xslt') then
  $std:xslt
else if($stepname eq 'ext:post') then
  $ext:post
else if($stepname eq 'p:group') then
  $xproc:group
else if($stepname eq 'p:try') then
  $xproc:try
else if($stepname eq 'p:catch') then
  $std:identity
else if($stepname eq 'p:for-each') then
  $xproc:for-each
else if($stepname eq 'p:viewport') then
  $xproc:viewport
else if($stepname eq 'p:replace') then
  $std:replace
else
 $std:identity
};
</pre></div><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><div><textarea rows="20" cols="100"><doc:xqdoc xmlns:doc="http://www.xqdoc.org/1.0"><doc:control><XQuery><Module><VersionDecl><TOKEN>xquery</TOKEN><TOKEN>version</TOKEN><StringLiteral>"3.0"</StringLiteral><TOKEN>encoding</TOKEN><StringLiteral>"UTF-8"</StringLiteral><Separator><TOKEN>;</TOKEN></Separator></VersionDecl><LibraryModule><ModuleDecl><TOKEN>module</TOKEN><TOKEN>namespace</TOKEN><NCName><NCName>xproc</NCName></NCName><TOKEN>=</TOKEN><URILiteral>"http://xproc.net/xproc"</URILiteral><Separator><TOKEN>;</TOKEN></Separator></ModuleDecl><Prolog><Setter><BoundarySpaceDecl><TOKEN>declare</TOKEN><TOKEN>boundary-space</TOKEN><TOKEN>preserve</TOKEN></BoundarySpaceDecl></Setter><Separator><TOKEN>;</TOKEN></Separator><Setter><CopyNamespacesDecl><TOKEN>declare</TOKEN><TOKEN>copy-namespaces</TOKEN><PreserveMode><TOKEN>no-preserve</TOKEN></PreserveMode><TOKEN>,</TOKEN><InheritMode><TOKEN>no-inherit</TOKEN></InheritMode></CopyNamespacesDecl></Setter><Separator><TOKEN>;</TOKEN></Separator><NamespaceDecl>

 (: declare namespaces :)
 <TOKEN>declare</TOKEN><TOKEN>namespace</TOKEN><NCName><NCName>p</NCName></NCName><TOKEN>=</TOKEN><URILiteral>"http://www.w3.org/ns/xproc"</URILiteral></NamespaceDecl><Separator><TOKEN>;</TOKEN></Separator><NamespaceDecl><TOKEN>declare</TOKEN><TOKEN>namespace</TOKEN><NCName><NCName>c</NCName></NCName><TOKEN>=</TOKEN><URILiteral>"http://www.w3.org/ns/xproc-step"</URILiteral></NamespaceDecl><Separator><TOKEN>;</TOKEN></Separator><NamespaceDecl><TOKEN>declare</TOKEN><TOKEN>namespace</TOKEN><NCName><NCName>err</NCName></NCName><TOKEN>=</TOKEN><URILiteral>"http://www.w3.org/ns/xproc-error"</URILiteral></NamespaceDecl><Separator><TOKEN>;</TOKEN></Separator><Import><ModuleImport>

 (: module imports :)
 <TOKEN>import</TOKEN><TOKEN>module</TOKEN><TOKEN>namespace</TOKEN><NCName><NCName>const</NCName></NCName><TOKEN>=</TOKEN><URILiteral>"http://xproc.net/xproc/const"</URILiteral><TOKEN>at</TOKEN><URILiteral>"const.xqm"</URILiteral></ModuleImport></Import><Separator><TOKEN>;</TOKEN></Separator><Import><ModuleImport><TOKEN>import</TOKEN><TOKEN>module</TOKEN><TOKEN>namespace</TOKEN><NCName><NCName>parse</NCName></NCName><TOKEN>=</TOKEN><URILiteral>"http://xproc.net/xproc/parse"</URILiteral><TOKEN>at</TOKEN><URILiteral>"parse.xqm"</URILiteral></ModuleImport></Import><Separator><TOKEN>;</TOKEN></Separator><Import><ModuleImport><TOKEN>import</TOKEN><TOKEN>module</TOKEN><TOKEN>namespace</TOKEN><NCName><NCName>u</NCName></NCName><TOKEN>=</TOKEN><URILiteral>"http://xproc.net/xproc/util"</URILiteral><TOKEN>at</TOKEN><URILiteral>"util.xqm"</URILiteral></ModuleImport></Import><Separator><TOKEN>;</TOKEN></Separator><Import><ModuleImport><TOKEN>import</TOKEN><TOKEN>module</TOKEN><TOKEN>namespace</TOKEN><NCName><NCName>std</NCName></NCName><TOKEN>=</TOKEN><URILiteral>"http://xproc.net/xproc/std"</URILiteral><TOKEN>at</TOKEN><URILiteral>"std.xqm"</URILiteral></ModuleImport></Import><Separator><TOKEN>;</TOKEN></Separator><Import><ModuleImport><TOKEN>import</TOKEN><TOKEN>module</TOKEN><TOKEN>namespace</TOKEN><NCName><NCName>opt</NCName></NCName><TOKEN>=</TOKEN><URILiteral>"http://xproc.net/xproc/opt"</URILiteral><TOKEN>at</TOKEN><URILiteral>"opt.xqm"</URILiteral></ModuleImport></Import><Separator><TOKEN>;</TOKEN></Separator><Import><ModuleImport><TOKEN>import</TOKEN><TOKEN>module</TOKEN><TOKEN>namespace</TOKEN><NCName><NCName>ext</NCName></NCName><TOKEN>=</TOKEN><URILiteral>"http://xproc.net/xproc/ext"</URILiteral><TOKEN>at</TOKEN><URILiteral>"ext.xqm"</URILiteral></ModuleImport></Import><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>

 (: declare variables :)
 <TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:eval-step</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionItemExpr><LiteralFunctionItem><EQName><FunctionName><EQName>xproc:evalstep</EQName></FunctionName></EQName><TOKEN>#</TOKEN><IntegerLiteral>5</IntegerLiteral></LiteralFunctionItem></FunctionItemExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>

 (: declare steps :)
 <TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:run-step</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionItemExpr><LiteralFunctionItem><EQName><FunctionName><EQName>xproc:run</EQName></FunctionName></EQName><TOKEN>#</TOKEN><IntegerLiteral>7</IntegerLiteral></LiteralFunctionItem></FunctionItemExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl><TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:declare-step</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl><TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:choose</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl><TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:try</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionItemExpr><LiteralFunctionItem><EQName><FunctionName><EQName>xproc:try</EQName></FunctionName></EQName><TOKEN>#</TOKEN><IntegerLiteral>4</IntegerLiteral></LiteralFunctionItem></FunctionItemExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl><TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:group</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionItemExpr><LiteralFunctionItem><EQName><FunctionName><EQName>xproc:group</EQName></FunctionName></EQName><TOKEN>#</TOKEN><IntegerLiteral>4</IntegerLiteral></LiteralFunctionItem></FunctionItemExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl><TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:for-each</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionItemExpr><LiteralFunctionItem><EQName><FunctionName><EQName>xproc:for-each</EQName></FunctionName></EQName><TOKEN>#</TOKEN><IntegerLiteral>4</IntegerLiteral></LiteralFunctionItem></FunctionItemExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl><TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:viewport</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionItemExpr><LiteralFunctionItem><EQName><FunctionName><EQName>xproc:viewport</EQName></FunctionName></EQName><TOKEN>#</TOKEN><IntegerLiteral>4</IntegerLiteral></LiteralFunctionItem></FunctionItemExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl><TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:library</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl><TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:pipeline</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl><TOKEN>declare</TOKEN><VarDecl><TOKEN>variable</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:variable</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><VarValue><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></VarValue></VarDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><OptionDecl>

 (: declare options :)
 <TOKEN>declare</TOKEN><TOKEN>option</TOKEN><EQName><FunctionName><EQName>saxon:output</EQName></FunctionName></EQName><StringLiteral>"indent=yes"</StringLiteral></OptionDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~ p:group step implementation
 :
 : @param $primary -
 : @param $secondary -
 : @param $options -
 : @param $currentstep -
 :
 : @returns 
 :)
(: -------------------------------------------------------------------------- :)
<TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:group</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>secondary</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>options</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause>
(: -------------------------------------------------------------------------- :)
<TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:enum-namespaces</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>string</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>p:declare-step</QName><DirAttributeList><S/><QName>name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>p:declare-step</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:output</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:evalAST</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:eval-step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>0</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~ p:try step implementation
 :
 : @param $primary -
 : @param $secondary -
 : @param $options -
 : @param $currentstep -
 :
 : @returns 
 :)
(: -------------------------------------------------------------------------- :)
<TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:try</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>secondary</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>options</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause>
(: -------------------------------------------------------------------------- :)
<TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:enum-namespaces</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>string</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast-try</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>p:declare-step</QName><DirAttributeList><S/><QName>name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><Wildcard>*</Wildcard></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>name</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ContextItemExpr><TOKEN>.</TOKEN></ContextItemExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>ne</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:catch'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>p:declare-step</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast-catch</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>p:declare-step</QName><DirAttributeList><S/><QName>name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:catch</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>p:declare-step</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><TryCatchExpr><TryClause><TOKEN>try</TOKEN><TOKEN>{</TOKEN><TryTargetExpr><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:output</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:evalAST</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast-try</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:eval-step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>0</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr></TryTargetExpr><TOKEN>}</TOKEN></TryClause><CatchClause><TOKEN>catch</TOKEN><CatchErrorList><NameTest><Wildcard>*</Wildcard></NameTest></CatchErrorList><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:output</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:evalAST</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast-catch</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:eval-step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>0</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></CatchClause></TryCatchExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~ p:for-each step implementation
 :
 : @param $primary -
 : @param $secondary -
 : @param $options -
 : @param $currentstep -
 :
 : @returns 
 :)
(: -------------------------------------------------------------------------- :)
<TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:for-each</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>secondary</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>options</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause>
(: -------------------------------------------------------------------------- :)
<TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:enum-namespaces</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>string</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>iteration-select</EQName></FunctionName></EQName></VarName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>string</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>ext:pre</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:iteration-source</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>select</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>p:declare-step</QName><DirAttributeList><S/><QName>name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>p:declare-step</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><FLWORExpr><InitialClause><ForClause><TOKEN>for</TOKEN><ForBinding><TOKEN>$</TOKEN><VarName><EQName><TOKEN>item</TOKEN></EQName></VarName><TOKEN>in</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:evalXPATH</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>iteration-select</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompDocConstructor><TOKEN>document</TOKEN><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></CompDocConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ForBinding></ForClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:output</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:evalAST</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:eval-step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><TOKEN>item</TOKEN></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>0</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~ p:viewport step implementation
 :
 : @param $primary -
 : @param $secondary -
 : @param $options -
 : @param $currentstep -
 :
 : @returns 
 :)
(: -------------------------------------------------------------------------- :)
<TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:viewport</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>secondary</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>options</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause>
(: -------------------------------------------------------------------------- :)
<TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:enum-namespaces</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>string</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>iteration-select</EQName></FunctionName></EQName></VarName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>string</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>ext:pre</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:viewport-source</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>select</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>p:declare-step</QName><DirAttributeList><S/><QName>name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>defaultname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>p:declare-step</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><FLWORExpr><InitialClause><ForClause><TOKEN>for</TOKEN><ForBinding><TOKEN>$</TOKEN><VarName><EQName><TOKEN>item</TOKEN></EQName></VarName><PositionalVar><TOKEN>at</TOKEN><TOKEN>$</TOKEN><VarName><EQName><FunctionName><TOKEN>count</TOKEN></FunctionName></EQName></VarName></PositionalVar><TOKEN>in</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:evalXPATH</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>iteration-select</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompDocConstructor><TOKEN>document</TOKEN><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></CompDocConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ForBinding></ForClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:output</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:evalAST</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:eval-step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><TOKEN>item</TOKEN></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>0</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~ resolve external bindings
 :
 : @param $a -
 : @param $b -
 :
 : @returns 
 :)
 (: --------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:resolve-external-bindings</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>a</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>b</EQName></FunctionName></EQName></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr>
 (: -------------------------------------------------------------------------- :)
<TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>

 (:~ generates a sequence of xs:string containing step names
 :
 : @param $step - 
 :
 : @returns xs:string of xproc:default-name
 :)
 (: --------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:genstepnames</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></Param></ParamList><TOKEN>)</TOKEN><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><ForClause>
 (: -------------------------------------------------------------------------- :)
      <TOKEN>for</TOKEN><ForBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>name</EQName></FunctionName></EQName></VarName><TOKEN>in</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><Wildcard>*</Wildcard></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:step</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"true"</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ForBinding></ForClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>name</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~ utility function for generating xproc:output
 :
 : @param $step - 
 : @param $port - 
 : @param $port-type - 
 : @param $primary - 
 : @param $content - 
 :
 : @returns xproc:output
 :)
 (: ------------------------------------------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:generate_output</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>port-type</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>content</EQName></FunctionName></EQName></Param></ParamList><TOKEN>)</TOKEN><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>xproc:output</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor>
 (: ------------------------------------------------------------------------------------------------------------- :)
 <TOKEN>&lt;</TOKEN><QName>xproc:output</QName><DirAttributeList><S/><QName>step</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port-type</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>port-type</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>primary</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>func</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>content</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>xproc:output</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~ resolve p:document input port bindings
 :
 : @param $href - href of document you wish to access
 :
 : @returns 
 :)
 (: -------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:resolve-document-binding</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>href</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList><TOKEN>)</TOKEN><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType></SequenceType><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><IfExpr>
 (: -------------------------------------------------------------------------- :)
    <TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>doc-available</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>href</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>doc</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>href</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:dynamicError</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'err:XD0002'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>concat</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>" cannot access document "</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>href</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


(:~ resolve p:data input port bindings
 :
 :
 : @param $href - xs:string
 : @param $wrapper  - xs:string
 :
 : @returns c:data
 :)
 (: -------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:resolve-data-binding</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>href</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>wrapper</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList><TOKEN>)</TOKEN><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>c:data</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor>
 (: -------------------------------------------------------------------------- :)
<TOKEN>&lt;</TOKEN><QName>c:data</QName><DirAttributeList><S/><QName>content-type</QName><S/><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>charset</QName><S/><TOKEN>=</TOKEN><S/><DirAttributeValue><TOKEN>"</TOKEN><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>encoding</QName><S/><TOKEN>=</TOKEN><S/><DirAttributeValue><TOKEN>"</TOKEN><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar>s</ElementContentChar></DirElemContent><DirElemContent><ElementContentChar>t</ElementContentChar></DirElemContent><DirElemContent><ElementContentChar>r</ElementContentChar></DirElemContent><DirElemContent><ElementContentChar>i</ElementContentChar></DirElemContent><DirElemContent><ElementContentChar>n</ElementContentChar></DirElemContent><DirElemContent><ElementContentChar>g</ElementContentChar></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><TOKEN>&lt;/</TOKEN><QName>c:data</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr>
(:
    u:dynamicError('err:XD0002',concat("cannot access file:  ",$href))
:)
 <TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


(:~ resolve input port bindings
 :
 : Will process p:empty, p:inline, p:document, p:data, p:pipe
 : or throw err:XD0001 
 :
 :
 : @param $input - 
 : @param $result  - TODO rename to outputs
 : @param $ast -
 : @param $currentstep 
 : @returns 
 :)
 (: -------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:resolve-port-binding</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><TypeswitchExpr>
 (: -------------------------------------------------------------------------- :)
   <TOKEN>typeswitch</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><CaseClause><TOKEN>case</TOKEN><SequenceTypeUnion><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:empty</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></SequenceTypeUnion><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>empty</QName><DirAttributeList/><TOKEN>/&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></CaseClause><CaseClause><TOKEN>case</TOKEN><SequenceTypeUnion><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:inline</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></SequenceTypeUnion><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><Wildcard>*</Wildcard></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></CaseClause><CaseClause><TOKEN>case</TOKEN><SequenceTypeUnion><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:document</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></SequenceTypeUnion><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:resolve-document-binding</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>href</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></CaseClause><CaseClause><TOKEN>case</TOKEN><SequenceTypeUnion><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:data</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></SequenceTypeUnion><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:resolve-data-binding</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>href</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>''</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></CaseClause><CaseClause><TOKEN>case</TOKEN><SequenceTypeUnion><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:pipe</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></SequenceTypeUnion><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:step-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></CaseClause><TOKEN>default</TOKEN><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:dynamicError</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'err:XD0001'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>concat</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"cannot bind to port: "</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>" step: "</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>' '</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:serialize</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>const:TRACE_SERIALIZE</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></TypeswitchExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


(:~ evaluates step options
 :
 :
 : @param $ast - 
 : @param $stepname - 
 :
 : @returns xproc:options
 :)
 (: -------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:eval-options</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList><TOKEN>)</TOKEN><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>xproc:options</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor>
 (: -------------------------------------------------------------------------- :)
     <TOKEN>&lt;</TOKEN><QName>xproc:options</QName><DirAttributeList/><TOKEN>&gt;</TOKEN><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><Wildcard>*</Wildcard></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><GeneralComp><TOKEN>=</TOKEN></GeneralComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:with-option</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><TOKEN>&lt;/</TOKEN><QName>xproc:options</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


(:~ evaluates secondary input bindings to a step
 :
 :
 : @param $ast - 
 : @param $currentstep
 : @param $primaryinput
 : @param $outputs
 :
 : @returns 
 :)
 (: -------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:eval-secondary</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:declare-step</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause>
 (: -------------------------------------------------------------------------- :)
 <TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step-name</EQName></FunctionName></EQName></VarName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>string</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><FLWORExpr><InitialClause><ForClause><TOKEN>for</TOKEN><ForBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName><TOKEN>in</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:input</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'false'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ForBinding></ForClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>xproc:input</QName><DirAttributeList><S/><QName>port</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>select</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>select</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primaryresult</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompDocConstructor><TOKEN>document</TOKEN><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><ForClause><TOKEN>for</TOKEN><ForBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><TOKEN>child</TOKEN></FunctionName></EQName></VarName><TOKEN>in</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ForBinding></ForClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:resolve-port-binding</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><TOKEN>child</TOKEN></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></CompDocConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>data</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><FLWORExpr><InitialClause><ForClause>
       (: resolve each nested port binding :)
       <TOKEN>for</TOKEN><ForBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input1</EQName></FunctionName></EQName></VarName><TOKEN>in</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><Wildcard>*</Wildcard></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ForBinding></ForClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:resolve-port-binding</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input1</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>name</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'xproc:output'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:evalXPATH</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>string</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>select</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>data</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>error</QName><DirAttributeList><S/><QName>type</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>v</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>a</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>l</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>-</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>s</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>c</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>n</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>d</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>a</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>y</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>/&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr>
           (:    u:dynamicError('err:XD0016',concat("xproc step ",$step-name, "did not select anything from p:input")) :)
   <TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><TOKEN>&lt;/</TOKEN><QName>xproc:input</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~ evaluates primary input bindings to a step
  :
  : a) checks to see if there are multiple children to p:input and uses xproc:resolve-port-binding to resolve them
  : b) applies xpath select processesing (if did not select anything this is an error)
  : c) 
  :
  :
  :
  : @param $ast - we require ast to refer to stuff
  : @param $step - 
  : @param $currentstep - actual current step
  : @param $primaryinput - primary input
  : @param $outputs - all of the previously processed steps outputs, including in scope variables and options
  :
  : @returns item()*
 :)
 (:---------------------------------------------------------------------------:)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:eval-primary</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:declare-step</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause>
 (: -------------------------------------------------------------------------- :)
 <TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step-name</EQName></FunctionName></EQName></VarName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>string</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pinput</EQName></FunctionName></EQName></VarName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:input</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType><OccurrenceIndicator><TOKEN>?</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:input</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>data</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr><TOKEN>and</TOKEN><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><TOKEN>empty</TOKEN></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><FLWORExpr><InitialClause><ForClause>
   (: resolve each nested port binding :)
   <TOKEN>for</TOKEN><ForBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName><TOKEN>in</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><Wildcard>*</Wildcard></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ForBinding></ForClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:resolve-port-binding</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>input</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>name</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'xproc:output'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:evalXPATH</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>string</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>select</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>data</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompDocConstructor><TOKEN>document</TOKEN><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></CompDocConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>error1</QName><DirAttributeList><S/><QName>type</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>v</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>a</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>l</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>-</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>i</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>m</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>a</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>y</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>/&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr>
   (:  u:dynamicError('err:XD0016',concat("xproc step ",$step-name, "did not select anything from p:input")) :)
<TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~ evaluates an xproc step
  :
  : @param $step - step's xproc:default-name
  : @param $namespaces - namespaces in use 
  : @param $primaryinput - standard input into the step
  : @param $ast - full abstract syntax tree of the pipeline being processed
  : @param $outputs - all of the previously processed steps outputs, including in scope variables and options
  :
  : @returns item()*
 :)
 (: -------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:evalstep</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>?</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:declare-step</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause>
 (: -------------------------------------------------------------------------- :)
     <TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>declarens</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:declare-ns</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>variables</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:variable</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>options</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:eval-options</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><Wildcard>*</Wildcard></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepfunc</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>name</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepfunction</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:getstep</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepfunc</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:eval-primary</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>secondary</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:eval-secondary</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primaryinput</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-href</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:log</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>href</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-port</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:log</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>name</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><GeneralComp><TOKEN>=</TOKEN></GeneralComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"p:declare-step"</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor>
             (: primary input port :)
             <TOKEN>&lt;</TOKEN><QName>xproc:output</QName><DirAttributeList><S/><QName>step</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port-type</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>i</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>n</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>href</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-port</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:input</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:result-document</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-href</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>primary</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>select</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:input</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>select</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:input</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>func</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepfunc</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>xproc:output</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr>
             (: all other input ports :)
             <TOKEN>(</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><ForClause><TOKEN>for</TOKEN><ForBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><TOKEN>child</TOKEN></FunctionName></EQName></VarName><TOKEN>in</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>secondary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:input</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ForBinding></ForClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>xproc:output</QName><DirAttributeList><S/><QName>step</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port-type</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>i</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>n</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>href</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-port</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><TOKEN>child</TOKEN></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:result-document</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-href</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><TOKEN>child</TOKEN></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>primary</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>f</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>a</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>l</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>s</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>select</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><TOKEN>child</TOKEN></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>select</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:input</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'false'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>func</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepfunc</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><TOKEN>child</TOKEN></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>xproc:output</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><IfExpr>
             (: primary output port :)
             <TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:output</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><GeneralComp><TOKEN>=</TOKEN></GeneralComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>xproc:output</QName><DirAttributeList><S/><QName>step</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port-type</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>href</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-port</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:output</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-href</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>primary</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>select</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:output</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>select</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:output</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>func</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepfunc</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepfunction</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>secondary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>options</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>variables</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>xproc:output</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>ext:pre</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>xproc:output</QName><DirAttributeList><S/><QName>step</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port-type</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>href</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-port</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:output</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-href</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>primary</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>select</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:output</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>select</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>s</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>l</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>func</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepfunc</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepfunction</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>secondary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>options</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>xproc:output</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor>
             (: all other primary output ports @TODO - needs to be handled :)
             <TOKEN>&lt;</TOKEN><QName>xproc:output</QName><DirAttributeList><S/><QName>step</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port-type</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>u</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>href</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-port</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:output</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'false'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>log-href</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>primary</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>f</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>a</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>l</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>s</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>select</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:output</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'false'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>select</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>port</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>currentstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><EQName><FunctionName><EQName>p:output</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'false'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>port</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>func</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepfunc</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>/&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~
  : lists all namespaces which are declared and in use within pipeline 
  : @TODO possibly move to util.xqm and delineate between declared and in use
  :
  : @param $pipeline - returns all in use namespaces

  : @returns &lt;namespace/&gt; element
  :)
 (: ------------------------------------------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:enum-namespaces</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>pipeline</EQName></FunctionName></EQName></Param></ParamList><TOKEN>)</TOKEN><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><TOKEN>namespace</TOKEN></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor>
 (: ------------------------------------------------------------------------------------------------------------- :)
    <TOKEN>&lt;</TOKEN><QName>namespace</QName><DirAttributeList><S/><QName>name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pipeline</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:enum-ns</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>dummy</QName><DirAttributeList/><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pipeline</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>dummy</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>namespace</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~
  : prepares the output from for xproc:stepFoldEngine
  :
  : This is a preprocess before serialization and actual output to standard output
  : or wherever externally from xprocxq
  :
  : @param $result - all outputs from the result of processing pipeline
  : @param $dflag - if true will output full processing trace
  :
  : @returns item()* 
  :)
 (: -------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:output</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>dflag</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:integer</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList><TOKEN>)</TOKEN><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause>
 (: -------------------------------------------------------------------------- :)
 <TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>subsequence</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>output</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>xproc:outputs</QName><DirAttributeList/><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>subsequence</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>2</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><TOKEN>&lt;/</TOKEN><QName>xproc:outputs</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>dflag</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>xproc:debug</QName><DirAttributeList><S/><QName>xmlns:p</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>h</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>:</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>.</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>3</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>.</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>g</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>n</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>s</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>x</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>c</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xmlns:ext</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>h</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>:</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>x</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>c</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>.</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>n</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>x</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>c</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>x</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xmlns:c</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>h</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>:</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>.</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>3</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>.</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>g</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>n</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>s</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>x</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>c</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>-</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>s</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xmlns:err</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>h</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>:</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>.</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>w</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>3</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>.</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>g</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>n</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>s</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>x</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>c</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>-</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xmlns:xxq-error</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>h</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>:</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>x</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>c</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>.</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>n</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>x</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>c</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/><QName>xmlns:opt</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><QuotAttrContentChar>h</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>:</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>x</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>c</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>.</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>n</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>e</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>x</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>r</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>c</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>/</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>o</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>p</QuotAttrContentChar></QuotAttrValueContent><QuotAttrValueContent><QuotAttrContentChar>t</QuotAttrContentChar></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue><S/></DirAttributeList><TOKEN>&gt;</TOKEN><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>xproc:pipeline</QName><DirAttributeList/><TOKEN>&gt;</TOKEN><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><TOKEN>&lt;/</TOKEN><QName>xproc:pipeline</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>output</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><DirElemContent><ElementContentChar/></DirElemContent><TOKEN>&lt;/</TOKEN><QName>xproc:debug</QName><TOKEN>&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>last</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><KindTest><AnyKindTest><TOKEN>node</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></AnyKindTest></KindTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~
  : runtime processing wrapper for xproc:stepFoldEngine 
  : @TODO - may push this down back to xproc:run
  :
  : This level of abstraction is probably temporary
  :
  : @param $ast - abstract syntax tree representing pipeline
  : @param $evalstep - function for evaluating each step (allows for flexible processing)
  : @param $namespaces - all namespaces that are used within pipeline
  : @param $stdin - standard input into the pipeline
  : @param $bindings - declared port bindings
  : @param $outputs - starting outputs, used for ext:xproc and branching pipelines
  :
  : @returns 
  :)
 (: ------------------------------------------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:evalAST</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:declare-step</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>evalstep</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><TOKEN>namespace</TOKEN></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>stdin</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>bindings</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>?</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param></ParamList><TOKEN>)</TOKEN><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause>
 (: ------------------------------------------------------------------------------------------------------------- :)
     <TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>steps</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:genstepnames</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pipeline-name</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:default-name</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:stepFoldEngine</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>steps</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>evalstep</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stdin</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>xproc:variable</QName><DirAttributeList/><TOKEN>/&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:resolve-external-bindings</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>bindings</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pipeline-name</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stdin</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:generate_output</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pipeline-name</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'result'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'external'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'true'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stdin</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~
  : xproc pipeline is processed using a recursive step fold function
  : 
  :
  : This is the central mechanism by which xprocxq works. By using a step-fold
  : function we have a flexible method of working with xproc branches, ext:xproc
  : invokes, as well as opening up all sorts of possibilities to work Map/Reduce
  : style.
  :
  :
  : 
  :
  :
  :
  :
  :  
  : @param $ast - abstract syntax tree representing pipeline
  : @param $namespaces - all namespaces that are used within pipeline
  : @param $steps - 
  : @param $evalstep-function - 
  : @param $primary - starting input
  : @param $outputs - starting outputs, used for ext:xproc and branching pipelines
  :
  : @returns ($ast, $outputs)
  :)
 (: -------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:stepFoldEngine</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><EQName>p:declare-step</EQName></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><KindTest><ElementTest><TOKEN>element</TOKEN><TOKEN>(</TOKEN><ElementNameOrWildcard><ElementName><EQName><FunctionName><TOKEN>namespace</TOKEN></FunctionName></EQName></ElementName></ElementNameOrWildcard><TOKEN>)</TOKEN></ElementTest></KindTest></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>steps</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>evalstep-function</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>?</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><IfExpr>
 (: -------------------------------------------------------------------------- :)

    <TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><TOKEN>empty</TOKEN></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>steps</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><FLWORExpr><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>evalstep-function</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>steps</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>primary</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:stepFoldEngine</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>remove</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>steps</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><NumericLiteral><IntegerLiteral>1</IntegerLiteral></NumericLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>evalstep-function</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>last</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>


 (:~
  : entry point into xprocxq returning the final serialized output of pipeline processing
  :
  : @param $pipeline - xproc pipeline
  : @param $stdin - externally defined standard input
  : @param $bindings - externally declared port bindings
  : @param $options - externally declared options
  : @param $outputs - externally declared output
  : @param $dflag - debug flag
  : @param $tflag - timing flag
  :
  : @returns item()*
  :)
 (: ------------------------------------------------------------------------------------------------------------- :)
 <TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:run</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>pipeline</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>stdin</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>?</TOKEN></OccurrenceIndicator></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>bindings</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>options</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>dflag</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:integer</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param><TOKEN>,</TOKEN><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>tflag</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:integer</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList><TOKEN>)</TOKEN><TOKEN>as</TOKEN><SequenceType><ItemType><TOKEN>item</TOKEN><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ItemType><OccurrenceIndicator><TOKEN>*</TOKEN></OccurrenceIndicator></SequenceType><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><FLWORExpr><InitialClause><LetClause>
 (: ------------------------------------------------------------------------------------------------------------- :)
 <TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><TOKEN>validate</TOKEN></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><ParenthesizedExpr><TOKEN>(</TOKEN><TOKEN>)</TOKEN></ParenthesizedExpr></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><IntermediateClause><InitialClause><LetClause> (: validation:jing($pipeline,fn:doc($const:xproc-rng-schema)) :)
 <TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:enum-namespaces</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pipeline</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>parse</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>parse:explicit-bindings</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>parse:AST</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>parse:explicit-name</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>parse:explicit-type</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pipeline</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>b</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>parse</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><Wildcard>*</Wildcard></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompElemConstructor><TOKEN>element</TOKEN><EQName><FunctionName><EQName>p:declare-step</EQName></FunctionName></EQName><TOKEN>{</TOKEN><ContentExpr><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>parse</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><Wildcard>*</Wildcard></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompNamespaceConstructor><TOKEN>namespace</TOKEN><Prefix><NCName><NCName>p</NCName></NCName></Prefix><TOKEN>{</TOKEN><URIExpr><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"http://www.w3.org/ns/xproc"</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr></URIExpr><TOKEN>}</TOKEN></CompNamespaceConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompNamespaceConstructor><TOKEN>namespace</TOKEN><Prefix><NCName><NCName>xproc</NCName></NCName></Prefix><TOKEN>{</TOKEN><URIExpr><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"http://xproc.net/xproc"</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr></URIExpr><TOKEN>}</TOKEN></CompNamespaceConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompNamespaceConstructor><TOKEN>namespace</TOKEN><Prefix><NCName><NCName>ext</NCName></NCName></Prefix><TOKEN>{</TOKEN><URIExpr><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"http://xproc.net/xproc/ext"</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr></URIExpr><TOKEN>}</TOKEN></CompNamespaceConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompNamespaceConstructor><TOKEN>namespace</TOKEN><Prefix><NCName><NCName>opt</NCName></NCName></Prefix><TOKEN>{</TOKEN><URIExpr><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"http://xproc.net/xproc/opt"</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr></URIExpr><TOKEN>}</TOKEN></CompNamespaceConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompNamespaceConstructor><TOKEN>namespace</TOKEN><Prefix><NCName><NCName>c</NCName></NCName></Prefix><TOKEN>{</TOKEN><URIExpr><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"http://www.w3.org/ns/xproc-step"</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr></URIExpr><TOKEN>}</TOKEN></CompNamespaceConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompNamespaceConstructor><TOKEN>namespace</TOKEN><Prefix><NCName><NCName>err</NCName></NCName></Prefix><TOKEN>{</TOKEN><URIExpr><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"http://www.w3.org/ns/xproc-error"</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr></URIExpr><TOKEN>}</TOKEN></CompNamespaceConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><ComputedConstructor><CompNamespaceConstructor><TOKEN>namespace</TOKEN><Prefix><NCName><NCName>xxq-error</NCName></NCName></Prefix><TOKEN>{</TOKEN><URIExpr><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"http://xproc.net/xproc/error"</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr></URIExpr><TOKEN>}</TOKEN></CompNamespaceConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>,</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>parse:pipeline-step-sort</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>b</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Constructor><DirectConstructor><DirElemConstructor><TOKEN>&lt;</TOKEN><QName>p:declare-step</QName><DirAttributeList><S/><QName>xproc:default-name</QName><TOKEN>=</TOKEN><DirAttributeValue><TOKEN>"</TOKEN><QuotAttrValueContent><CommonContent><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>const:init_unique_id</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></CommonContent></QuotAttrValueContent><TOKEN>"</TOKEN></DirAttributeValue></DirAttributeList><TOKEN>/&gt;</TOKEN></DirElemConstructor></DirectConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr></ContentExpr><TOKEN>}</TOKEN></CompElemConstructor></ComputedConstructor></Constructor></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>checkAST</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>u:assert</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>not</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><TOKEN>empty</TOKEN></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr><TOKEN>/</TOKEN><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><NodeTest><NameTest><Wildcard>*</Wildcard></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList><Predicate><TOKEN>[</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><AxisStep><ForwardStep><AbbrevForwardStep><TOKEN>@</TOKEN><NodeTest><NameTest><EQName><FunctionName><EQName>xproc:step</EQName></FunctionName></EQName></NameTest></NodeTest></AbbrevForwardStep></ForwardStep><PredicateList/></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>]</TOKEN></Predicate></PredicateList></AxisStep></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>"pipeline AST has no steps"</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>eval_result</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:evalAST</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ast</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:eval-step</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>namespaces</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stdin</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>bindings</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>outputs</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><IntermediateClause><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>serialized_result</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>xproc:output</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>eval_result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>,</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>dflag</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause></IntermediateClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><FLWORExpr><InitialClause><LetClause><TOKEN>let</TOKEN><LetBinding><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>g</EQName></FunctionName></EQName></VarName><TOKEN>:=</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>parse:AST</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>parse:explicit-name</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><FunctionCall><FunctionName><EQName>parse:explicit-type</EQName></FunctionName><ArgumentList><TOKEN>(</TOKEN><Argument><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>pipeline</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Argument><TOKEN>)</TOKEN></ArgumentList></FunctionCall></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></LetBinding></LetClause></InitialClause><ReturnClause><TOKEN>return</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>serialized_result</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></ReturnClause></FLWORExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator><AnnotatedDecl>



(:~ waiting for fn:function-lookup() to be supported by XQuery implementations
 :
 : This is a *temporary* function as a dynamic function constructor
 : it eventually will be replaced by the new fn:function-lookup() 
 : function which will make its way into the final xquery/xpath 3.0
 : specs
 :
 : @param $stepname - string containing name of element
 :
 : @returns function
 :
 :)
(: -------------------------------------------------------------------------- :)
<TOKEN>declare</TOKEN><FunctionDecl><TOKEN>function</TOKEN><EQName><FunctionName><EQName>xproc:getstep</EQName></FunctionName></EQName><TOKEN>(</TOKEN><ParamList><Param><TOKEN>$</TOKEN><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName><TypeDeclaration><TOKEN>as</TOKEN><SequenceType><ItemType><AtomicOrUnionType><EQName><FunctionName><EQName>xs:string</EQName></FunctionName></EQName></AtomicOrUnionType></ItemType></SequenceType></TypeDeclaration></Param></ParamList><TOKEN>)</TOKEN><FunctionBody><EnclosedExpr><TOKEN>{</TOKEN><Expr><ExprSingle><IfExpr>
(: -------------------------------------------------------------------------- :)
<TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:identity'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:identity</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:count'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:count</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:pack'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:pack</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:delete'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:delete</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:add-attribute'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:add-attribute</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:add-xml-base'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:add-xml-base</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:error'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:error</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:escape-markup'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:escape-markup</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:unescape-markup'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:unescape-markup</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:directory-list'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:directory-list</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:load'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:load</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:store'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:store</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:make-absolute-uris'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:make-absolute-uris</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:compare'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:compare</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:label-elements'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:label-elements</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'ext:pre'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ext:pre</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:rename'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:rename</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:filter'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:filter</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:string-replace'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:string-replace</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:split-sequence'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:split-sequence</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:sink'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:sink</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:set-attributes'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:set-attributes</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:rename'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:rename</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:wrap'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:wrap</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:wrap-sequence'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:wrap-sequence</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:unwrap'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:unwrap</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:xslt'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:xslt</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'ext:post'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>ext:post</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:group'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:group</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:try'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:try</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:catch'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:identity</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:for-each'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:for-each</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:viewport'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>xproc:viewport</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><IfExpr><TOKEN>if</TOKEN><TOKEN>(</TOKEN><Expr><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>stepname</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr><ValueComp><TOKEN>eq</TOKEN></ValueComp><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><Literal><StringLiteral>'p:replace'</StringLiteral></Literal></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></Expr><TOKEN>)</TOKEN><TOKEN>then</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:replace</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle><TOKEN>else</TOKEN><ExprSingle><OrExpr><AndExpr><ComparisonExpr><RangeExpr><AdditiveExpr><MultiplicativeExpr><UnionExpr><IntersectExceptExpr><InstanceofExpr><TreatExpr><CastableExpr><CastExpr><UnaryExpr><ValueExpr><PathExpr><RelativePathExpr><StepExpr><PostfixExpr><PrimaryExpr><VarRef><TOKEN>$</TOKEN><VarName><EQName><FunctionName><EQName>std:identity</EQName></FunctionName></EQName></VarName></VarRef></PrimaryExpr></PostfixExpr></StepExpr></RelativePathExpr></PathExpr></ValueExpr></UnaryExpr></CastExpr></CastableExpr></TreatExpr></InstanceofExpr></IntersectExceptExpr></UnionExpr></MultiplicativeExpr></AdditiveExpr></RangeExpr></ComparisonExpr></AndExpr></OrExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></IfExpr></ExprSingle></Expr><TOKEN>}</TOKEN></EnclosedExpr></FunctionBody></FunctionDecl></AnnotatedDecl><Separator><TOKEN>;</TOKEN></Separator></Prolog></LibraryModule></Module><EOF/></XQuery><!--Generated by xquerydoc: http://github.com/xquery/xquerydoc--><doc:date>2011-12-04T19:09:40.485+01:00</doc:date><doc:version><VersionDecl><TOKEN>xquery</TOKEN><TOKEN>version</TOKEN><StringLiteral>"3.0"</StringLiteral><TOKEN>encoding</TOKEN><StringLiteral>"UTF-8"</StringLiteral><Separator><TOKEN>;</TOKEN></Separator></VersionDecl></doc:version></doc:control><doc:module type="library"><doc:uri/></doc:module><doc:variables><doc:variable><doc:uri>eval-step</doc:uri></doc:variable><doc:variable><doc:uri>run-step</doc:uri></doc:variable><doc:variable><doc:uri>declare-step</doc:uri></doc:variable><doc:variable><doc:uri>choose</doc:uri></doc:variable><doc:variable><doc:uri>try</doc:uri></doc:variable><doc:variable><doc:uri>group</doc:uri></doc:variable><doc:variable><doc:uri>for-each</doc:uri></doc:variable><doc:variable><doc:uri>viewport</doc:uri></doc:variable><doc:variable><doc:uri>library</doc:uri></doc:variable><doc:variable><doc:uri>pipeline</doc:uri></doc:variable><doc:variable><doc:uri>variable</doc:uri></doc:variable></doc:variables><doc:functions><doc:function><doc:name>group</doc:name><doc:signature>($primary,$secondary,$options,$currentstep)</doc:signature><doc:parameters><doc:parameter><doc:name>primary</doc:name></doc:parameter><doc:parameter><doc:name>secondary</doc:name></doc:parameter><doc:parameter><doc:name>options</doc:name></doc:parameter><doc:parameter><doc:name>currentstep</doc:name></doc:parameter></doc:parameters></doc:function><doc:function><doc:name>try</doc:name><doc:signature>($primary,$secondary,$options,$currentstep)</doc:signature><doc:parameters><doc:parameter><doc:name>primary</doc:name></doc:parameter><doc:parameter><doc:name>secondary</doc:name></doc:parameter><doc:parameter><doc:name>options</doc:name></doc:parameter><doc:parameter><doc:name>currentstep</doc:name></doc:parameter></doc:parameters></doc:function><doc:function><doc:name>for-each</doc:name><doc:signature>($primary,$secondary,$options,$currentstep)</doc:signature><doc:parameters><doc:parameter><doc:name>primary</doc:name></doc:parameter><doc:parameter><doc:name>secondary</doc:name></doc:parameter><doc:parameter><doc:name>options</doc:name></doc:parameter><doc:parameter><doc:name>currentstep</doc:name></doc:parameter></doc:parameters></doc:function><doc:function><doc:name>viewport</doc:name><doc:signature>($primary,$secondary,$options,$currentstep)</doc:signature><doc:parameters><doc:parameter><doc:name>primary</doc:name></doc:parameter><doc:parameter><doc:name>secondary</doc:name></doc:parameter><doc:parameter><doc:name>options</doc:name></doc:parameter><doc:parameter><doc:name>currentstep</doc:name></doc:parameter></doc:parameters></doc:function><doc:function><doc:name>resolve-external-bindings</doc:name><doc:signature>($a,$b)</doc:signature><doc:parameters><doc:parameter><doc:name>a</doc:name></doc:parameter><doc:parameter><doc:name>b</doc:name></doc:parameter></doc:parameters></doc:function><doc:function><doc:name>genstepnames</doc:name><doc:signature>($step) as  xs:string*</doc:signature><doc:parameters><doc:parameter><doc:name>step</doc:name></doc:parameter></doc:parameters><doc:return><doc:type occurrence="*"> xs:string</doc:type></doc:return></doc:function><doc:function><doc:name>generate_output</doc:name><doc:signature>($step,$port,$port-type,$primary,$content) as  element(xproc:output)</doc:signature><doc:parameters><doc:parameter><doc:name>step</doc:name></doc:parameter><doc:parameter><doc:name>port</doc:name></doc:parameter><doc:parameter><doc:name>port-type</doc:name></doc:parameter><doc:parameter><doc:name>primary</doc:name></doc:parameter><doc:parameter><doc:name>content</doc:name></doc:parameter></doc:parameters><doc:return><doc:type> element(xproc:output)</doc:type></doc:return></doc:function><doc:function><doc:name>resolve-document-binding</doc:name><doc:signature>($href as xs:string) as  item()</doc:signature><doc:parameters><doc:parameter><doc:name>href</doc:name><doc:type> xs:string</doc:type></doc:parameter></doc:parameters><doc:return><doc:type> item()</doc:type></doc:return></doc:function><doc:function><doc:name>resolve-data-binding</doc:name><doc:signature>($href as xs:string,$wrapper as xs:string) as  element(c:data)</doc:signature><doc:parameters><doc:parameter><doc:name>href</doc:name><doc:type> xs:string</doc:type></doc:parameter><doc:parameter><doc:name>wrapper</doc:name><doc:type> xs:string</doc:type></doc:parameter></doc:parameters><doc:return><doc:type> element(c:data)</doc:type></doc:return></doc:function><doc:function><doc:name>resolve-port-binding</doc:name><doc:signature>($input,$outputs,$ast,$currentstep)</doc:signature><doc:parameters><doc:parameter><doc:name>input</doc:name></doc:parameter><doc:parameter><doc:name>outputs</doc:name></doc:parameter><doc:parameter><doc:name>ast</doc:name></doc:parameter><doc:parameter><doc:name>currentstep</doc:name></doc:parameter></doc:parameters></doc:function><doc:function><doc:name>eval-options</doc:name><doc:signature>($ast,$stepname as xs:string) as  element(xproc:options)</doc:signature><doc:parameters><doc:parameter><doc:name>ast</doc:name></doc:parameter><doc:parameter><doc:name>stepname</doc:name><doc:type> xs:string</doc:type></doc:parameter></doc:parameters><doc:return><doc:type> element(xproc:options)</doc:type></doc:return></doc:function><doc:function><doc:name>eval-secondary</doc:name><doc:signature>($ast as element(p:declare-step),$currentstep,$primaryinput as item()*,$outputs as item()*)</doc:signature><doc:parameters><doc:parameter><doc:name>ast</doc:name><doc:type> element(p:declare-step)</doc:type></doc:parameter><doc:parameter><doc:name>currentstep</doc:name></doc:parameter><doc:parameter><doc:name>primaryinput</doc:name><doc:type occurrence="*"> item()</doc:type></doc:parameter><doc:parameter><doc:name>outputs</doc:name><doc:type occurrence="*"> item()</doc:type></doc:parameter></doc:parameters></doc:function><doc:function><doc:name>eval-primary</doc:name><doc:signature>($ast as element(p:declare-step),$currentstep,$primaryinput as item()*,$outputs as item()*)</doc:signature><doc:parameters><doc:parameter><doc:name>ast</doc:name><doc:type> element(p:declare-step)</doc:type></doc:parameter><doc:parameter><doc:name>currentstep</doc:name></doc:parameter><doc:parameter><doc:name>primaryinput</doc:name><doc:type occurrence="*"> item()</doc:type></doc:parameter><doc:parameter><doc:name>outputs</doc:name><doc:type occurrence="*"> item()</doc:type></doc:parameter></doc:parameters></doc:function><doc:function><doc:name>evalstep</doc:name><doc:signature>($step,$namespaces,$primaryinput as item()?,$ast as element(p:declare-step),$outputs)</doc:signature><doc:parameters><doc:parameter><doc:name>step</doc:name></doc:parameter><doc:parameter><doc:name>namespaces</doc:name></doc:parameter><doc:parameter><doc:name>primaryinput</doc:name><doc:type occurrence="?"> item()</doc:type></doc:parameter><doc:parameter><doc:name>ast</doc:name><doc:type> element(p:declare-step)</doc:type></doc:parameter><doc:parameter><doc:name>outputs</doc:name></doc:parameter></doc:parameters></doc:function><doc:function><doc:name>enum-namespaces</doc:name><doc:signature>($pipeline) as  element(namespace)</doc:signature><doc:parameters><doc:parameter><doc:name>pipeline</doc:name></doc:parameter></doc:parameters><doc:return><doc:type> element(namespace)</doc:type></doc:return></doc:function><doc:function><doc:name>output</doc:name><doc:signature>($result,$dflag as xs:integer) as  item()*</doc:signature><doc:parameters><doc:parameter><doc:name>result</doc:name></doc:parameter><doc:parameter><doc:name>dflag</doc:name><doc:type> xs:integer</doc:type></doc:parameter></doc:parameters><doc:return><doc:type occurrence="*"> item()</doc:type></doc:return></doc:function><doc:function><doc:name>evalAST</doc:name><doc:signature>($ast as element(p:declare-step),
   $evalstep,$namespaces as element(namespace),$stdin as item()* ,$bindings,$outputs as item()?) as  item()*</doc:signature><doc:parameters><doc:parameter><doc:name>ast</doc:name><doc:type> element(p:declare-step)</doc:type></doc:parameter><doc:parameter><doc:name>evalstep</doc:name></doc:parameter><doc:parameter><doc:name>namespaces</doc:name><doc:type> element(namespace)</doc:type></doc:parameter><doc:parameter><doc:name>stdin</doc:name><doc:type occurrence="*"> item()</doc:type></doc:parameter><doc:parameter><doc:name>bindings</doc:name></doc:parameter><doc:parameter><doc:name>outputs</doc:name><doc:type occurrence="?"> item()</doc:type></doc:parameter></doc:parameters><doc:return><doc:type occurrence="*"> item()</doc:type></doc:return></doc:function><doc:function><doc:name>stepFoldEngine</doc:name><doc:signature>( $ast as element(p:declare-step),
                              $namespaces as element(namespace),
                              $steps as xs:string*,
                              $evalstep-function,
                              $primary as item()?,
                              $outputs as item()*)</doc:signature><doc:parameters><doc:parameter><doc:name>ast</doc:name><doc:type> element(p:declare-step)</doc:type></doc:parameter><doc:parameter><doc:name>namespaces</doc:name><doc:type> element(namespace)</doc:type></doc:parameter><doc:parameter><doc:name>steps</doc:name><doc:type occurrence="*"> xs:string</doc:type></doc:parameter><doc:parameter><doc:name>evalstep-function</doc:name></doc:parameter><doc:parameter><doc:name>primary</doc:name><doc:type occurrence="?"> item()</doc:type></doc:parameter><doc:parameter><doc:name>outputs</doc:name><doc:type occurrence="*"> item()</doc:type></doc:parameter></doc:parameters></doc:function><doc:function><doc:name>run</doc:name><doc:signature>($pipeline,$stdin as item()?,$bindings,$options,$outputs,$dflag as xs:integer ,$tflag as xs:integer) as  item()*</doc:signature><doc:parameters><doc:parameter><doc:name>pipeline</doc:name></doc:parameter><doc:parameter><doc:name>stdin</doc:name><doc:type occurrence="?"> item()</doc:type></doc:parameter><doc:parameter><doc:name>bindings</doc:name></doc:parameter><doc:parameter><doc:name>options</doc:name></doc:parameter><doc:parameter><doc:name>outputs</doc:name></doc:parameter><doc:parameter><doc:name>dflag</doc:name><doc:type> xs:integer</doc:type></doc:parameter><doc:parameter><doc:name>tflag</doc:name><doc:type> xs:integer</doc:type></doc:parameter></doc:parameters><doc:return><doc:type occurrence="*"> item()</doc:type></doc:return></doc:function><doc:function><doc:name>getstep</doc:name><doc:signature>($stepname as xs:string)</doc:signature><doc:parameters><doc:parameter><doc:name>stepname</doc:name><doc:type> xs:string</doc:type></doc:parameter></doc:parameters></doc:function></doc:functions></doc:xqdoc></textarea></div><script type="application/javascript">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html>